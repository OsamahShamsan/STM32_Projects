// === menu.c ===
#include "menu.h"
#include "uart_dma.h"
#include "vt100.h"
#include <string.h>

#define TOTAL_MENU_LINES 3
#define MENU_LINE_SIZE 64

static char menu_lines[TOTAL_MENU_LINES][MENU_LINE_SIZE] = {
    "Option 1 - Sensor Config",
    "Option 2 - Motor Control",
    "Option 3 - System Info"
};

void send_line(const char* text, const char* style) {
    uart_dma_send((uint8_t*)style, strlen(style));
    uart_dma_send((uint8_t*)text, strlen(text));
    uart_dma_send((uint8_t*)VT100_RESET, strlen(VT100_RESET));
    uart_dma_send((uint8_t*)"\r\n", 2);
}

void Menu_Init(void) {
    uart_dma_send((uint8_t*)VT100_CLEAR_SCREEN, strlen(VT100_CLEAR_SCREEN));
    uart_dma_send((uint8_t*)VT100_CURSOR_HOME, strlen(VT100_CURSOR_HOME));
}

void Menu_Display(void) {
    // Intro box
    uart_dma_send((uint8_t*)"-------------------------\r\n", 27);
    uart_dma_send((uint8_t*)"  > Menu 1 - Short\r\n", 21);
    uart_dma_send((uint8_t*)"    Menu 2 - Medium width line\r\n", 34);
    uart_dma_send((uint8_t*)"    Menu 3 - This is a very long line to test wrapping\r\n", 58);
    uart_dma_send((uint8_t*)"-------------------------\r\n", 27);
    uart_dma_send((uint8_t*)"Use \x1B[1m↑\x1B[0m \x1B[1m↓\x1B[0m to navigate. Press Enter to select.\r\n\r\n", 60);

    // Options section (simulated selection with VT100_REVERSE on first option)
    for (int i = 0; i < TOTAL_MENU_LINES; i++) {
        if (i == 0) {
            send_line(menu_lines[i], VT100_REVERSE);
        } else {
            send_line(menu_lines[i], "");
        }
    }
}
