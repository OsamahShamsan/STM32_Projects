// === uart_dma.c ===
#include "stm32g4xx_hal.h"
#include "uart_dma.h"

extern UART_HandleTypeDef huart2;

static volatile uint8_t dma_busy = 0;

void uart_dma_send(uint8_t* data, uint16_t size) {
    while (dma_busy); // Wait for previous transmission to finish
    dma_busy = 1;
    HAL_UART_Transmit_DMA(&huart2, data, size);
}

void HAL_UART_TxCpltCallback(UART_HandleTypeDef *huart) {
    if (huart == &huart2) {
        dma_busy = 0;
    }
}
