// === menu.c ===
#include "menu.h"
#include "flash_storage.h"
#include "uart_dma.h"
#include "vt100.h"

#define TOTAL_MENU_LINES 3
#define FLASH_LINE_SIZE 64

static char* menu_lines[TOTAL_MENU_LINES];

void Menu_Init(void) {
    // Clear terminal screen and move cursor to home
    uart_dma_transmit((uint8_t*)VT100_CLEAR_SCREEN, strlen(VT100_CLEAR_SCREEN));
    uart_dma_transmit((uint8_t*)VT100_CURSOR_HOME, strlen(VT100_CURSOR_HOME));

    flash_storage_init();
    flash_storage_read_menu(&menu_lines[0]);
}

void Menu_Display(void) {
    char temp[FLASH_LINE_SIZE];
    for (int i = 0; i < TOTAL_MENU_LINES; i++) {
        memcpy(temp, menu_lines[i], FLASH_LINE_SIZE);
        uart_dma_transmit((uint8_t*)temp, FLASH_LINE_SIZE);
        uart_dma_transmit((uint8_t*)"\r\n", 2);
    }
}
